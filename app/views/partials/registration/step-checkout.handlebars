<div class="container-fluid">
  <div class="row">
    <div class="col-sm-4">
      <div class="row sticky-top">
        <div class="col-sm-12">
          {{#if results.event.docs.img}}
            <img src="{{results.event.docs.img.[0]}}" alt="{{results.event.name}}" class="img-fluid">
          {{else}}
            <img src="/img/thumb.png" alt="{{results.event.name}}" class="img-fluid">
          {{/if}}
            <ul>
              <li><strong>Lieu :</strong> {{results.event.adresse.ville}} {{results.event.adresse.codePostal}}</li>
            </ul>
          {{#each results.event.epreuves}}
            <ul class="spacer-sm-top">
              <li><strong>Epreuve :</strong> {{this.name}}</li>
              <li><strong>Discipline :</strong> {{this.discipline}}</li>
              <li><strong>Date :</strong> {{date this.date_debut}} à {{dateHours this.date_debut}}h{{dateMinutes this.date_debut}}</li>
              <li><strong>Distance :</strong> {{this.distance}}Km</li>
              <li><strong>Denivelé + :</strong> {{this.denivele}} mètres</li>
              <li><strong>Nombre de participants maximum:</strong> {{this.placesDispo}}</li>
              <li><strong>Tarif:</strong> {{this.tarif}}€</li> 
            </ul>
          {{/each}}
        </div>
      </div>      
    </div>

    <!--formulaire d'inscription block-->
    <div class="col-sm-8 bg-light" id="divForm">
      
      <div class="sticky-top">

        <!-- titre -->
        <div class="row">
          <div class="col-11 mx-auto mt-3">
            <div class="row">
              <div class="col-12 bg-white border border-right-0 border-left-0 border-top-0">
                <h1 class="d-block mt-5 mb-5 text-lowercase text-center">
                  Votre inscription - {{results.event.name}}
                </h1>
              </div>
            </div>
          </div>
        </div>

        <!--formulaire d'inscription-->
        <form action="/inscription/checkout/{{data.registration.id}}" id="checkout-form" method="POST">
          <div class="row" id="step-epreuve">
            <div class="col-11 mx-auto mt-3 bg-white">

              <!--Step 1. epreuve-->

              <!-- epreuves -->
              <div class="row">
                <div class="col-12">
                  <strong class="d-block mt-3 mb-3 ml-2 text-lowercase text-left">
                    Panier
                  </strong>
                </div>
              </div>
              {{#each results.produits}}
                <div class="row mb-3">

                  <!-- quantité -->
                  <div class="col-3">
                    <span>{{this.produitsQuantite}}</span>                
                  </div>

                  <!-- epreuve name -->
                  <div class="col-7 ">
                    <span>
                        {{this.produitsRef}}
                    </span>
                  </div>

                  <!-- subtotal -->
                  <div class="col-2 text-right subtotal">
                    <span>{{this.produitsSubTotal}}</span> EUR
                  </div>
                </div>
              {{/each}}             
            </div>
          </div>

          <!-- total -->
          <div class="row">
            <div class="col-11 mx-auto">
              <div class="row bg-dark-blue">
                <div class="col-8 text-white">
                  <strong class="d-block mt-3 mb-3 text-lowercase text-left">
                   Total ttc
                  </strong>
                </div>
                <div class="col-4" id="total-ttc">
                  <strong class="d-block mt-3 mb-3 text-white text-right">
                    <span>{{results.orderAmount}}</span> EUR
                  </strong>
                </div>
              </div>
            </div>
          </div>

          <div class="row mb-3 mt-3">
            <div class="col-11 mx-auto bg-white">
              <div class="row">
                <!-- nav participant -->
                <div class="col-12">
                  <!-- header participant -->
                  <div class="row">
                    <div class="col-12">
                      <span class="d-block mt-2 mb-2">
                        <i class="fa fa-check text-success" aria-hidden="true"></i> Participant
                      </span>                      
                    </div>
                  </div>
                </div>

                <!-- nav paiement -->
                <div class="col-12 border border-left-0 border-right-0">
                  <div class="row">
                    <div class="col-12">
                      <span class="d-block mt-2 mb-2">
                        <strong class="text-muted">
                          Paiement
                        </strong>
                      </span>                      
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 mx-auto">  
                      <div>      
                      <!-- PAIEMENT ACCEPTED-->
                      {{#if data.registration.event.paiement}}
                        <!-- paiement CB already done -->
                        {{#if data.registration.paiement.captured}}
                          <div id="helper">
                            <span class="d-block text-center  mt-5 mb-5">
                              <i class="fa fa-check-circle-o fa-4x text-success"></i>
                            </span>
                            <p>Votre inscription est payée, aucune action n'est requise de votre part.</p>
                            <p>Votre référence de paiement est : {{data.registration.paiement.id}}</p>
                            <p>Pour toute question relative à votre inscription, merci de contacter le service client via le chat en bas de l'écran ou par email à serviceclient@izir.fr.</p>
                            <p>Pour toute question relative à l'épreuve, merci de contacter l'organisateur de celle-ci.</p>
                            <p>Merci de votre compréhension.</p>                
                          </div>
                        <!-- paiement to do -->
                        {{else}}
                          <!-- other paiement option already choose and accept by organisateur -->
                          {{#if data.registration.paiement.other_captured}}
                            <div id="helper">
                              <span class="d-block text-center mt-5 mb-5">
                                <i class="fa fa-check-circle-o fa-4x text-success"></i>
                              </span>
                              <p>L'organisateur à bien reçus votre paiement, aucune action supplémenatire n'est requise de votre part.</p>
                              <p>Pour toute question relative à votre inscription, merci de contacter le service client via le chat en bas de l'écran ou par email à serviceclient@izir.fr.</p>
                              <p>Pour toute question relative à l'épreuve, merci de contacter le l'organisateur de celle-ci.</p>
                              <p>Merci de votre compréhension.</p>              
                            </div>
                          {{else}}
                            <!-- other paiement option already choose and BUT NOT accept by organisateur -->
                            {{#if data.registration.paiement.other}}
                              <div class="heper">
                                <p class="spacer-sm-bottom"><strong>Vous avez choisi un paiement par chèque / espèce pour valider votre inscription.</strong> Ce règlement sera à envoyer à l'adresse de la permanance de l'organisation de l'évènement (si le delai postal le permet) ou à donner en main propre au guichet de l'organisation lorsque que vous vous présenterez à l'évènement.</p>
                                <p>Votre place ne peut-être garantie tant que l'organisateur n'est pas en possession de votre paiement.</p>
                                <p>L'organisateur validera votre inscription après réception de son paiement.</p>                      
                              </div>
                            {{else}}
                              <!-- paiement to action -->
                              <div id="helper">
                                <span><i class="fa fa-exclamation-triangle mr-2" aria-hidden="true"></i>Votre inscription ne sera envoyée à l'oganisateur qu'après son paiement. Pour valider votre inscription, merci de choisir l'un des modes de paiement ci-dessus.</span>
                              </div>
                              <div class="row border border-muted mb-3 paiement_option mt-3">
                                <div class="col-10 mx-auto mt-2 mb-2">
                                  <div class="row">
                                    <div class="col-12">
                                      <span class="btn btn-muted mr-3"><i class="fa fa-check-square paiement_option_checkbox" aria-hidden="true"></i></span><strong>Paiement par carte bancaire</strong>                            
                                    </div>
                                  </div>
                                  <div class="paiement_option_sub">
                                    <div class="row">
                                      <div class="col-12">
                                        <p>Informations sur ce moyen de paiement</p>
                                        <p>Ce règlement garantie votre place et valide votre inscription instantanément. En le choississant, finie la queue au gichet le jour de l'événement pour payer l'inscription.</p>
                                        <div class="row">
                                          <div class="col-sm-3">
                                            <img class="img-fluid mt-2 mb-2" src="/img/rect3737.png" alt="Paiement sécurisé" width="50" height="50">
                                          </div>
                                          <div class="col-sm-9">
                                            <p class="mb-2 mt-2 "><strong>Paiement 100% sécurisé</strong></p>
                                            <img class="img-fluid" src="/img/cb-visa-mastercard.png" alt="Paiement sécurisé" width="auto" height="100%">
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="row">
                                      <div class="col-12 mt-2">
                                        <script 
                                          src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                                          input-type="submit"
                                          data-label="Valider mon paiement"
                                          data-email="{{data.registration.participant.email}}"
                                          data-key="{{data.stripeFrontKey}}"
                                          data-amount="{{data.stripe}}"
                                          data-name="event.izir"
                                          data-description="{{data.registration.eventName}}"
                                          data-locale="auto"
                                          data-currency="EUR"
                                          > 
                                        </script> 
                                      </div>
                                    </div>                          
                                  </div>
                                </div>
                              </div>
                              <div class="row border border-muted mb-3 paiement_option">
                                <div class="col-10 mx-auto mt-2 mb-2">
                                  <div class="row">
                                    <div class="col-12">
                                      <span class="btn btn-muted mr-3"><i class="fa fa-square-o paiement_option_checkbox" aria-hidden="true"></i></span><strong>Paiement par chèque / espèce</strong>  
                                    </div>
                                  </div>
                                  <div class="hidde paiement_option_sub">
                                    <div class="row">
                                      <div class="col-12">
                                        <p>Informations sur ce moyen de paiement</p>
                                        <p>Ce règlement sera à envoyer à l'adresse de la permanance de l'organisation de l'évènement (si le delai postal le permet) ou à donner en main propre au guichet de l'organisation lorsque que vous vous présenterez à l'évènement. L'organisateur validera votre inscription après réception de son paiement.</p>
                                        <p><strong>Ce moyen de paiement ne vous garantie pas votre place pour cet événement.</strong></p>
                                      </div>
                                    </div>
                                    <div class="row">
                                      <div class="col-12">
                                        <a href="/inscription/checkout/{{data.registration.id}}/other-paiement" class="btn btn-secondary d-block spacer-xs-top" id="other-checkout">Valider mon paiement</a>
                                      </div>
                                    </div>                          
                                  </div>
                                </div>
                              </div>
                            {{/if}}
                          {{/if}}
                        {{/if}}
                      <!-- PAIEMENT NOT ACCEPTED-->
                      {{else}}
                        <div id="helper">
                          <p>Votre inscription a bien été prise en compte.</p>
                          <p>Vous ne pouvez pas payer votre inscription car l'organisateur n'a pas activé cette fonctionnalité. L'organisateur vous demandera donc de payer les votre inscription au guichet de l'événement.</p>
                          <p>Merci de votre compréhension.</p>
                        </div>
                      {{/if}}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- nav certificat -->
                {{#if results.event.certificat_required}}
                  <div class="col-12 border border-left-0 border-right-0 border-top-0">
                    <span class="d-block mt-2 mb-2">
                      <i class="fa fa-check text-muted" aria-hidden="true"></i> Certificat
                    </span>
                  </div>
                {{/if}}  

                <!-- nav confirmation               -->
                <div class="col-12 border border-left-0 border-right-0 border-top-0">
                  <span class="d-block mt-2 mb-2">
                    <i class="fa fa-check text-muted" aria-hidden="true"></i> Confirmation
                  </span>
                </div>
              </div>
            </div>

            <input type="hidden" name="stripe" value="{{data.stripe}}">
            <input type="hidden" name="event" value="{{data.registration.event.name}}">

          </div>

          <div class="col-11 mx-auto">
            <!-- user helper  -->
            <div class="row" >
              <div class="col-11 mx-auto alert alert-warning">
                <span id="checkout-validation-warning">
                </span>               
              </div>
            </div>

            <div class="row">
              <div class="col-6 mb-5 text-center">
                <a class="btn btn-outline-primary" href="/event/{{results.event.id}}">Détails de l'évènement</a>
              </div>
              {{#if origine.recap_user}}
                <div class="col-6 mb-5 text-center">
                  <a class="btn btn-outline-primary" href="/inscription/recap/user/{{user.id}}">Mes inscriptions ></a>
                </div>
              {{/if}}
            </div>             
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
<input type="hidden" value="{{results.event.date_cloture_inscription}}" name="dateLimite">
